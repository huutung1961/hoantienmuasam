
<input id="link" placeholder="D√°n link Shopee d·∫°ng /product/..." />
<button onclick="analyze()">Ph√¢n t√≠ch s·∫£n ph·∫©m</button>
<div id="result"></div>
<button id="affBtn" style="display:none" onclick="openAffiliate()">
  üëâ T·∫°o link Affiliate Shopee
</button>

<script>
let currentLink = "";

async function analyze() {
  const link = document.getElementById("link").value.trim();
  if (!link.includes("shopee.vn/product")) {
    alert("Link kh√¥ng h·ª£p l·ªá");
    return;
  }

  currentLink = link;
  document.getElementById("result").innerHTML = "‚è≥ ƒêang x·ª≠ l√Ω...";

  const res = await fetch("/api/get-product", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url: link })
  });

  const data = await res.json();
  if (data.error) {
    document.getElementById("result").innerText = "‚ùå " + data.error;
    return;
  }

  document.getElementById("result").innerHTML = `
    <h3>${data.title}</h3>
    <p>Gi√°: ${data.price.toLocaleString()}ƒë</p>
    <p>Hoa h·ªìng ∆∞·ªõc t√≠nh: ${data.commission.toLocaleString()}ƒë</p>
    ${data.image ? `<img src="${data.image}" width="100%">` : ""}
  `;

  document.getElementById("affBtn").style.display = "block";
}

function openAffiliate() {
  window.open(
    "https://affiliate.shopee.vn/offer/product?url=" +
      encodeURIComponent(currentLink),
    "_blank"
  );
}
</script>
